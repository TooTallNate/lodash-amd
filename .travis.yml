language: node_js
node_js:
  - "0.10"
env:
  global:
    - BUILD="compat" MAKE=false SAUCELABS=false
    - SAUCE_USERNAME="jdalton"
    - secure: "eY5rJdhdRseArRr++JAEcixtRuvkw6blajJI75z/LzEWNJLRo0N17iG0QTzbAdCrzM+FB0ZgDglt9wAGJfVUK+WIfLPnORQHlhsRqkag9y6BzZ3o1SylLBqQtvvz8Ft67PjpGtVRhIECPEhGf6uQwb/p+AjGoUYl4XqPOJ+OLug="
  matrix:
    - LOADER="curl"
    - LOADER="dojo"
    - LOADER="requirejs"
    - BUILD="modern" LOADER="curl"
    - BUILD="modern" LOADER="dojo"
    - BUILD="modern" LOADER="requirejs"
    - BUILD="legacy" LOADER="curl"
    - BUILD="legacy" LOADER="dojo"
    - BUILD="legacy" LOADER="requirejs"
    - BUILD="mobile" LOADER="curl"
    - BUILD="mobile" LOADER="dojo"
    - BUILD="mobile" LOADER="requirejs"
matrix:
  include:
    - node_js: "0.8"
      env: SAUCELABS=true MAKE=true
git:
  depth: 10
branches:
  only:
    - master
before_install:
  - "git clone --depth=10 --branch=master git://github.com/lodash/lodash.git ./node_modules/lodash"
  - "[ $BUILD != 'compat' ] && [ $BUILD != 'modern' ] && MAKE=true || true"
  - "[ $SAUCELABS != false ] && npm i ecstatic request sauce-tunnel || true"
  - "[ $MAKE != false ] && git clone --depth=10 --branch=master git://github.com/lodash/lodash-cli.git ./node_modules/lodash-cli || true"
  - "[ $MAKE != false ] && mkdir ./node_modules/lodash-cli/node_modules && cd ./node_modules/lodash-cli/node_modules/ && ln -s ../../lodash ./lodash && cd ../../../ || true"
  - "[ $SAUCELABS == false ] && [ $MAKE != false ] && node ./node_modules/lodash-cli/bin/lodash modularize $BUILD exports=amd -o ./$BUILD || true"
  - "[ $SAUCELABS != false ] && node ./node_modules/lodash-cli/bin/lodash modularize legacy exports=amd -o ./legacy || true"
  - "[ $SAUCELABS != false ] && node ./node_modules/lodash-cli/bin/lodash modularize mobile exports=amd -o ./mobile || true"
script:
  - "[ $SAUCELABS != false ] && true || phantomjs ./node_modules/lodash/test/test.js \"node_modules/lodash/test/index.html?build=../../../$BUILD/main.js&loader=$LOADER\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=curl\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=curl&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=dojo\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=dojo&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=requirejs\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../compat/main.js&loader=requirejs&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../modern/main.js&loader=curl\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../modern/main.js&loader=dojo\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../modern/main.js&loader=requirejs\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=curl\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=curl&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=dojo\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=dojo&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=requirejs\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../legacy/main.js&loader=requirejs&compat=7\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../mobile/main.js&loader=curl\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../mobile/main.js&loader=dojo\""
  - "[ $SAUCELABS == false ] && true || node ./node_modules/lodash/test/saucelabs.js \"node_modules/lodash/test/index.html?build=../../../mobile/main.js&loader=requirejs\""
